<!DOCTYPE html>
<html>
<head>
    <title>Office Remote</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <link rel="stylesheet" href="Content/jquery.mobile-1.4.0.css" />

    <script src="Scripts/jquery-1.8.2.min.js"></script>
    <script src="Scripts/hammer-1.0.6.js"></script>
    <!--<script src="Scripts/jquery.specialevent.hammer.js"></script>-->
    <script src="Scripts/jquery.mobile-1.4.0.min.js"></script>
    <style>
        #swipeme {
            text-align: center;
            /*border: 2px dashed gray;
            line-height: 500px;
            height: 100%;
            font-size: 2em;
            width: 100%;*/
        }
        #touchme {
            text-align: center;
        }

        .fileinput-button {
            position: relative;
            overflow: hidden;
            float: left;
            margin-right: 4px;
        }

        .fileinput-button input {
            position: absolute;
            top: 0;
            right: 0;
            margin: 0;
            opacity: 0;
            filter: alpha(opacity=0);
            transform: translate(-300px, 0) scale(4);
            font-size: 23px;
            direction: ltr;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="mainPage" data-role="page" >

        <div data-role="header" data-theme="b" style="background-color:#FF3C00; border:0px">
            <a href="" style="top:2px; background-color: transparent; border:0px" class="ui-btn btnHome"><img src="images/office_logo.png" /></a>
            <h1>Gesture</h1>
            
                <span id="btnPlay" class="ui-btn ui-corner-all fileinput-button" style="position: absolute; top:-2px; right:0px; background-color:#FF3C00; border:0px">
                    <span id="spSlideShow">Play</span>
                    <input id="image-picker" type="file" accept="image/*" data-role="none" />
                </span>
            
        </div>

        <div id="swipeme" data-role="content">
            <span style="vertical-align:middle"><h1>Swipe here</h1></span>
        </div>

        <div data-role="footer" data-theme="a" style="text-align:center;">
<!--            <span class="ui-btn ui-corner-all fileinput-button">-->
            <a href="#controlPage" style="top:0px;" data-transition="flip" class="ui-btn">Mouse Control</a>
            <!--</span>-->
            <h1>&nbsp;</h1>
        </div>

    </div>

    <div id="controlPage" data-role="page">

        <div data-role="header" data-theme="b" style="background-color:#1E82CC; border:0px">
            <a href="" style="top: 2px; background-color: transparent; border:0px" class="ui-btn btnHome"><img src="images/office_logo.png" /></a>
            <h1>Mouse</h1>
            <span class="ui-btn ui-icon-plus ui-btn-icon-left ui-corner-all fileinput-button" style="position: absolute; top:-2px; right:0px; background-color:#1E82CC; border:0px">
                <span>Photo</span>
                <input id="image-picker" type="file" accept="image/*" data-role="none" />
            </span>
        </div>

        <div id="touchme" data-role="content">
            <span style="vertical-align:middle"><h1>Drag here</h1></span>
        </div>

        <div data-role="footer" style="text-align:center">
            <a href="#mainPage" style="top:0px;" data-transition="flip" class="ui-btn">Gesture Control</a>
            <h1>&nbsp;</h1>
        </div>

    </div>

    <div id="myDialog" data-role="page" data-dialog="true">
        <div data-role="header" data-theme="b">
		<h1>Welcome</h1>
		</div>

		<div role="main" class="ui-content">
		<h1>Office Remote <br /> Ver 0.0.1</h1>
		<p>This App is for MODC 2013-2014 Hack Day demo only. Designed by Chao Xiang and Jianming Zhao. <br /><br />Where shall we start?</p>
			<a href="#mainPage" data-transition="fade" class="ui-btn ui-shadow ui-corner-all ui-btn-a">Gesture Control</a>
			<a href="#controlPage" data-transition="fade" class="ui-btn ui-shadow ui-corner-all ui-btn-a">Mouse Control</a>
		</div>
	</div>
    
    <script>
        (function ($) {

            var firstTime = 1;
            if (firstTime == 1) {
                setTimeout(function () { $.mobile.changePage("#myDialog", { transition: 'pop' }); }, 10);
                firstTime = 0;
            }

            $(".btnHome").click(function (e) {
                e.stopImmediatePropagation();
                e.preventDefault();

                $.mobile.changePage("#myDialog", { transition: 'pop' });
            });

            $("#btnPlay").click(function (e) {
                e.stopImmediatePropagation();
                e.preventDefault();

                var eventType = 'run';
                if ($("#spSlideShow").text() == "Play") {
                    eventType = 'run';
                    $("#spSlideShow").text("Stop");
                } else {
                    eventType = 'stop';
                    $("#spSlideShow").text("Play");
                }

                $.ajax({
                    url: "http://" + window.location.hostname + ":59256/Handlers/OfficeRemoteProxy.ashx",
                    data: {
                        type: eventType,
                        /*touches: event.touches.length,*/
                        offset_x: 0,
                        offset_y: 0
                    }
                });
            });

            $(document).delegate('#mainPage', 'pageshow', function () {
                
            });

            var the_height = ($(window).height() - $("#mainPage").find('[data-role="header"]').height() - $("#mainPage").find('[data-role="footer"]').height() - 120);
            $("#mainPage").height($(window).height()).find('[data-role="content"]').height(the_height);
            $("#swipeme").css("line-height", (the_height - 45) + "px");
            $("#touchme").css("line-height", (the_height - 45) + "px");

            document.ontouchmove = function (event) {
                event.preventDefault();
            }

            var sm = document.getElementById('swipeme'),
                tm = document.getElementById('touchme');

            var prevDistanceX = 0;
            var prevDistanceY = 0;

            Hammer(sm).on('swipe', function (event) {
                event.gesture.preventDefault();

                var myType = event.type;

                $.ajax({
                    url: "http://" + window.location.hostname + ":59256/Handlers/OfficeRemoteProxy.ashx",
                    data: {
                        type: myType,
                        direction: event.gesture.direction,
                        offset_x: 0,
                        offset_y: 0
                    }
                });

                console.log("Type: " + event.type + ", Direction: " + event.direction);
            });

            Hammer(tm, { drag_max_touches: 3 }).on('drag', function (event) {
                event.gesture.preventDefault();

                var offsetX = (event.gesture.deltaX - prevDistanceX) * 3;
                var offsetY = (event.gesture.deltaY - prevDistanceY) * 3;

                var myType = event.type;
                var clicks = 1;
                var skip = false;

                $.ajax({
                    url: "http://" + window.location.hostname + ":59256/Handlers/OfficeRemoteProxy.ashx",
                    data: {
                        type: myType,
                        /*touches: event.touches.length,*/
                        clicks: clicks,
                        direction: event.gesture.direction,
                        offset_x: offsetX,
                        offset_y: offsetY
                    }
                });

                console.log("Type: " + event.type + ", Direction: " + event.gesture.direction + ", Offset: " + offsetX + "," + offsetY + ",touches: " + event.gesture.touches.length);
                //if (event.gesture.touches.length > 1)
                //    alert(event.gesture.touches.length);
                console.log(event);

                prevDistanceX = event.gesture.deltaX;
                prevDistanceY = event.gesture.deltaY;
            });

            Hammer(tm).on('dragend', function (event) {
                event.gesture.preventDefault();
                prevDistanceX = 0;
                prevDistanceY = 0;
            });

            Hammer(tm).on('tap', function (event) {
                event.gesture.preventDefault();
                
                $.ajax({
                    url: "http://" + window.location.hostname + ":59256/Handlers/OfficeRemoteProxy.ashx",
                    data: {
                        type: event.type,
                        /*touches: event.touches.length,*/
                        direction: event.gesture.direction,
                        offset_x: 0,
                        offset_y: 0
                    }
                });
            });

        }(jQuery));
    </script>
</body>
</html>