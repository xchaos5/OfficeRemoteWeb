<!DOCTYPE html>
<html>
<head>
    <title>Office Remote</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <link rel="stylesheet" href="Content/jquery.mobile-1.4.0.css" />

    <script src="Scripts/jquery-1.8.2.min.js"></script>
    <script src="Scripts/hammer.js"></script>
    <script src="Scripts/jquery.specialevent.hammer.js"></script>
    <script src="Scripts/jquery.mobile-1.4.0.min.js"></script>
    <style>
        #swipeme {
            text-align: center;
            /*border: 3px dashed orange;
            line-height: 500px;
            height: 100%;
            font-size: 2em;
            width: 100%;*/
        }
        #touchme {
            text-align: center;
        }

        .fileinput-button {
            position: relative;
            overflow: hidden;
            float: left;
            margin-right: 4px;
        }

        .fileinput-button input {
            position: absolute;
            top: 0;
            right: 0;
            margin: 0;
            opacity: 0;
            filter: alpha(opacity=0);
            transform: translate(-300px, 0) scale(4);
            font-size: 23px;
            direction: ltr;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="mainPage" data-role="page" >

        <div data-role="header" data-theme="b">
            <h1>Gesture Control</h1>
        </div>

        <div id="swipeme" data-role="content">
            <span style="vertical-align:middle"><h1>Touch here</h1></span>
        </div>

        <div data-role="footer" data-theme="a">
<!--            <span class="ui-btn ui-corner-all fileinput-button">-->
                <a href="#controlPage" data-transition="flip" class="ui-btn">Mouse Control</a>
            <!--</span>-->
            <h1>&nbsp;</h1>
        </div>

    </div>

    <div id="controlPage" data-role="page">

        <div data-role="header" data-theme="b">
            <h1>Gesture Control</h1>
        </div>

        <div id="touchme" data-role="content">
            <span style="vertical-align:middle"><h1>Touch here</h1></span>
        </div>

        <div data-role="footer">
            <span class="ui-btn ui-icon-plus ui-btn-icon-left ui-corner-all fileinput-button">
                <span>Photo</span>
                <input id="image-picker" type="file" accept="image/*" data-role="none" />
            </span>
            <h1>&nbsp;</h1>
        </div>

    </div>

    <div id="myDialog" data-role="page" data-dialog="true">
        <div data-role="header" data-theme="b">
		<h1>About</h1>
		</div>

		<div role="main" class="ui-content">
		<h1>Office Remote <br /> Ver 0.0.1</h1>
		<p>This App is for MODC 2013-2014 Hack Day demo only. Designed by Chao Xiang and Jianming Zhao. <br /><br />Where shall we start?</p>
			<a href="#mainPage" data-transition="turn" class="ui-btn ui-shadow ui-corner-all ui-btn-a">Gesture Control</a>
			<a href="#controlPage" data-transition="flip" class="ui-btn ui-shadow ui-corner-all ui-btn-a">Mouse Control</a>
		</div>
	</div>
    
    <script>
        (function ($) {
            //alert(window.location.hostname);

            // send connect message
            //$.ajax({
            //    url: "http://" + window.location.hostname + ":59256/Handlers/OfficeRemoteProxy.ashx"
            //});
            var firstTime = 1;
            if (firstTime == 1) {
                setTimeout(function () { $.mobile.changePage("#myDialog", { transition: 'pop' }); }, 10);
                firstTime = 0;
            }

            $(document).delegate('#mainPage', 'pageshow', function () {
                
            });

            var the_height = ($(window).height() - $("#mainPage").find('[data-role="header"]').height() - $("#mainPage").find('[data-role="footer"]').height() - 120);
            $("#mainPage").height($(window).height()).find('[data-role="content"]').height(the_height);
            $("#swipeme").css("line-height", (the_height - 45) + "px");
            $("#touchme").css("line-height", (the_height - 45) + "px");

            document.ontouchmove = function (event) {
                event.preventDefault();
            }

            var $sw = $('#swipeme'),
                $output = $('#output');

            var prevDistanceX = 0;
            var prevDistanceY = 0;
            // hold tap swipe doubletap transformstart transform transformend dragstart drag dragend release
            $sw.on('hold tap swipe doubletap dragstart drag dragend', function (event) {
                event.preventDefault();
                var offsetX = (event.distanceX - prevDistanceX);
                var offsetY = (event.distanceY - prevDistanceY) * 3;

                var myType = event.type;
                var clicks = 1;
                var skip = false;

                //if (myType == "drag") {
                //    myType = "pan"
                    // if (Math.abs(offsetX) < 2 && (event.direction == 'left' || event.direction == 'right'))
                    //     skip = true;
                    // if (Math.abs(offsetY) < 2 && (event.direction == 'up' || event.direction == 'down'))
                    //     skip = true;
                //}
                //else if (myType == "release")
                //    myType = "touchup";
                //else if (myType == "hold")
                //    myType = "press";
                //else if (myType == "doubletap") {
                //    myType = "tap";
                //    clicks = 2;
                //}

                if (!skip)
                    $.ajax({
                        url: "http://" + window.location.hostname + ":59256/Handlers/OfficeRemoteProxy.ashx",
                        data: {
                            type: myType,
                            /*touches: event.touches.length,*/
                            clicks: clicks,
                            direction: event.direction,
                            offset_x: offsetX * 4,
                            offset_y: offsetY
                        }
                    });

                console.log("Type: " + event.type + ", Direction: " + event.direction + ", Offset: " + offsetX + "," + offsetY);

                prevDistanceX = event.distanceX;
                prevDistanceY = event.distanceY;
            });

            // this is how you unbind an event
            /*$sw.on('swipe', function (event) {
                event.preventDefault();

                $sw.off('tap');
            });*/
        }(jQuery));
    </script>
</body>
</html>